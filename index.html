<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/uuid@latest/dist/umd/uuidv4.min.js"></script>
    <script>
        // Import the functions you need from the SDKs you need
        // import { initializeApp, firestore } from "https://www.gstatic.com/firebasejs/9.6.2/firebase-app.js";
        // import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.2/firebase-analytics.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyBYI9w6SvjKunO8FpN9brxqiK0D1wbKQyY",
          authDomain: "poker-game-95fbb.firebaseapp.com",
          projectId: "poker-game-95fbb",
          storageBucket: "poker-game-95fbb.appspot.com",
          messagingSenderId: "387535463262",
          appId: "1:387535463262:web:69c330e0f1c2d397e8a5cf",
          measurementId: "G-N4G86VGF0E"
        };
      
        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        // const analytics = getAnalytics(app);

        const db = firebase.firestore(app);

        function setCookie(cname, cvalue, exdays) {
            const d = new Date();
            d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
            let expires = "expires="+d.toUTCString();
            document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
        }

        function getCookie(cname) {
            let name = cname + "=";
            let ca = document.cookie.split(';');
            for(let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') {
                c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        var username = ""
        username = getCookie("username");
        if(username == "") {
            username = prompt("Please enter your name:", "");
            if (username != "" && username != null) {
            setCookie("username", username, 365);
            }
        }

        var roomId = ""
        roomId = getCookie("roomId")
        if(roomId == "") {
            roomId = uuidv4()
            setCookie("roomId", roomId, 365)
        }

        firebase.database().ref("messages/" + roomId).on("child_added", (snapshot) => {
            const data = snapshot.val()
            // $('.chat-container2').animate({scrollTop: $('.chat-container2').prop('scrollHeight')});
            // console.log($(".chat-container2").())
            $(".chat-container2").append(`
            <div class="eachchat-container">
                <div class="message-container other-message">
                    <div class="name-container">
                        <h5>${data.sender}</h5>
                    </div>
                    <div class="message-content">
                    ${data.content}    
                    </div>
                </div>
            </div>
            `)
            $('.chat-container2').scrollTop($('.chat-container2').prop('scrollHeight'))
        })

        function sendMessage() {
            let message = $('#cc').val()
            $('#cc').val("")
            $('.chat-container2').animate({scrollTop: $('.chat-container2').prop('scrollHeight')});
            // let username = prompt("What 's your name?")
            firebase.database().ref("messages/" + roomId).push().set({
                "sender": username,
                "content": message
            })
            .then((docRef) => {
                console.log("Message added", docRef)                
                // document.getElementById('cc').innerText = ""
            })
            .catch((err) => {
                console.log("Message error", err)
            })
        }

        function enterRoom() {
            let newRoomId = $("#roomId").val()
            roomId = newRoomId
            setCookie("roomId", roomId, 365)
            location.reload()
        }

        $(document).ready(function() {
            $('.header').html("Your roomd id is " + roomId)
            $('#cc').keydown(function(e) {
                if(e.keyCode == 13) {
                    sendMessage()
                }
            })
            $('.chat-container2').scrollTop($('.chat-container2').prop('scrollHeight'))
        })

      </script>
      <link rel="stylesheet" href="chat.css">
</head>
<body>
    <h1 class="header">Chat app</h1>
    <input id="roomId" type="text" placeholder="Enter room id you want to enter ...">
    <button id="enter" onclick="enterRoom()">Enter</button>
    <!-- <input type="text"> -->
    <div class="chat-container">
        <div class="chat-container2">
        </div>

        <div class="message-input-container">
            <input id="cc" type="text" placeholder="Enter your message ...">
            <button onclick="sendMessage()">Send</button>
        </div>
    </div>
</body>
</html>


            <!-- <div class="eachchat-container">
                <div class="message-container other-message">
                    <div class="name-container">
                        <h5>Anh Nguyen</h5>
                    </div>
                    <div class="message-content">
                        ! Ipsum velit? Bibendum sit facilisis wisi! Suspendisse ab aute eu, parturient, dictum, inceptos exercitationem blanditiis incidunt ac non! Porta vulputate voluptatem blandit? Possimus adipisicing, labore natoque pariatur conubia nesciunt mauris luctus feugiat commodi accusantium, class
                    </div>
                </div>
            </div>
    
            <div class="eachchat-container">
                <div class="message-container my-message">
                    <div class="name-container">
                        <h5>Anh Nguyen</h5>
                    </div>
                    <div class="message-content">
                        ! Ipsum velit? Bibendum sit facilisis wisi! Suspendisse ab aute eu, parturient, dictum, inceptos exercitationem blanditiis incidunt ac non! Porta vulputate voluptatem blandit? Possimus adipisicing, labore natoque pariatur conubia nesciunt mauris luctus feugiat commodi accusantium, class
                    </div>
                </div>
            </div> -->